<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Рулетка Роскомнадзора</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Properties для кнопки -->
    <style>
        /* CSS Variables для оптимизации */
        :root {
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --z-index-modal: 1000;
            --z-index-loader: 10000;
            --z-index-theme: 1001;
        }
        
        @property --pos-x {
            syntax: '<percentage>';
            initial-value: 40%;
            inherits: false;
        }

        @property --pos-y {
            syntax: '<percentage>';
            initial-value: 140%;
            inherits: false;
        }

        @property --spread-x {
            syntax: '<percentage>';
            initial-value: 130%;
            inherits: false;
        }

        @property --spread-y {
            syntax: '<percentage>';
            initial-value: 170.06%;
            inherits: false;
        }

        @property --color-1 {
            syntax: '<color>';
            initial-value: #000022;
            inherits: false;
        }

        @property --color-2 {
            syntax: '<color>';
            initial-value: #1f3f6d;
            inherits: false;
        }

        @property --color-3 {
            syntax: '<color>';
            initial-value: #469396;
            inherits: false;
        }

        @property --color-4 {
            syntax: '<color>';
            initial-value: #f1ffa5;
            inherits: false;
        }

        @property --color-5 {
            syntax: '<color>';
            initial-value: hsla(250, 80%, 2.5%, 1);
            inherits: false;
        }

        @property --border-angle {
            syntax: '<angle>';
            initial-value: 180deg;
            inherits: true;
        }

        @property --border-color-1 {
            syntax: '<color>';
            initial-value: hsla(320, 75%, 90%, 0.9);
            inherits: true;
        }

        @property --border-color-2 {
            syntax: '<color>';
            initial-value: hsla(320, 50%, 90%, 0.1);
            inherits: true;
        }

        @property --stop-1 {
            syntax: '<percentage>';
            initial-value: 37.35%;
            inherits: false;
        }

        @property --stop-2 {
            syntax: '<percentage>';
            initial-value: 61.36%;
            inherits: false;
        }

        @property --stop-3 {
            syntax: '<percentage>';
            initial-value: 78.42%;
            inherits: false;
        }

        @property --stop-4 {
            syntax: '<percentage>';
            initial-value: 93.52%;
            inherits: false;
        }

        @property --stop-5 {
            syntax: '<percentage>';
            initial-value: 100%;
            inherits: false;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            background: linear-gradient(135deg, #0a0e2a 0%, #111633 50%, #0d1129 100%);
            color: #e0e0ff;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            transition: background 0.5s ease, color 0.5s ease;
            will-change: background, color;
            position: relative;
        }
        
        /* Улучшенная светлая тема */
        body.light-theme {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #ffffff 100%);
            color: #334155;
        }
        
        /* Улучшенный логотип РКН для темной темы */
        .roskom-logo {
            width: 140px;
            height: 140px;
            background: linear-gradient(145deg, #1a1f3d, #15182f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6), inset 0 4px 8px rgba(255, 255, 255, 0.05);
            border: 4px solid #6366f1;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            transition: transform var(--transition-normal);
            will-change: transform;
        }
        
        .roskom-logo:hover {
            transform: translateZ(20px) rotateX(5deg) rotateY(5deg);
        }
        
        .roskom-logo::before {
            content: "";
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #6366f1, #8b5cf6, #6366f1);
            border-radius: 50%;
            z-index: -1;
            opacity: 0.4;
            filter: blur(15px);
            will-change: opacity;
        }
        
        .roskom-logo i {
            font-size: 80px;
            color: #8b5cf6;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.8);
            transform: translateZ(30px);
            will-change: transform;
        }
        
        /* Улучшенный градиент надписи РОСКОМНАДЗОР */
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #6366f1, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 15px rgba(99, 102, 241, 0.3);
            letter-spacing: 1px;
            transform: translateZ(20px);
            will-change: transform;
        }
        
        /* Улучшенный логотип для светлой темы */
        .light-theme .roskom-logo {
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2), 
                       inset 0 4px 8px rgba(255, 255, 255, 0.9);
            border: 4px solid #8b5cf6;
        }
        
        .light-theme .roskom-logo i {
            color: #8b5cf6;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
        }
        
        .light-theme .roskom-logo::before {
            background: linear-gradient(45deg, #8b5cf6, #a78bfa, #8b5cf6);
        }
        
        .light-theme h1 {
            background: linear-gradient(to right, #8b5cf6, #ec4899, #f59e0b);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 2px 15px rgba(139, 92, 246, 0.2);
        }
        
        /* Новый цветовой акцент для кнопки "Крутить колесо" в светлой теме */
        .light-theme .spin-button {
            background: radial-gradient(
                var(--spread-x) var(--spread-y) at var(--pos-x) var(--pos-y),
                #8b5cf6 var(--stop-1),
                #a78bfa var(--stop-2),
                #c4b5fd var(--stop-3),
                #ddd6fe var(--stop-4),
                #f5f3ff var(--stop-5)
            );
            color: rgba(30, 41, 59, 0.95);
        }
        
        .light-theme .spin-button::before {
            background-image: linear-gradient(var(--border-angle), rgba(139, 92, 246, 0.3), rgba(167, 139, 250, 0.1));
        }
        
        .light-theme .spin-button:hover {
            --color-1: #7c3aed;
            --color-2: #a78bfa;
            --color-3: #c4b5fd;
            --color-4: #ddd6fe;
            --color-5: #f5f3ff;
            
            --border-color-1: rgba(139, 92, 246, 0.2);
            --border-color-2: rgba(167, 139, 250, 0.4);
        }
        
        .subtitle {
            font-size: 2rem;
            margin-bottom: 40px;
            color: #a0a8ff;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            font-weight: 300;
            transform: translateZ(15px);
            will-change: transform;
        }
        
        .light-theme .subtitle {
            color: #64748b;
        }
        
        .light-theme .roulette-container {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.1), 
                       inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
        }
        
        .light-theme .wheel-container {
            background: rgba(241, 245, 249, 0.7);
            border: 1px solid #e2e8f0;
        }
        
        .light-theme .wheel-item {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            color: #334155;
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.1), 
                       inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
        }
        
        .light-theme .control-button {
            background: linear-gradient(145deg, #6366f1, #4f46e5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.2);
        }
        
        .light-theme .control-button:hover {
            background: linear-gradient(145deg, #4f46e5, #4338ca);
            transform: translateY(-2px) translateZ(10px);
            box-shadow: 0 12px 20px rgba(99, 102, 241, 0.3);
        }
        
        .light-theme .stat-label {
            color: #64748b;
        }
        
        .light-theme .stat-value {
            color: #8b5cf6;
            text-shadow: 0 0 10px rgba(139, 92, 246, 0.3);
        }
        
        .light-theme .stats {
            background: rgba(241, 245, 249, 0.8);
            border: 1px solid #e2e8f0;
        }
        
        .light-theme .modal-content {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            box-shadow: 0 25px 50px rgba(99, 102, 241, 0.15);
            border: 1px solid #e2e8f0;
        }
        
        .light-theme .modal-content::before {
            background: linear-gradient(to right, #8b5cf6, #ec4899, #8b5cf6);
        }
        
        .light-theme .action-button {
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .light-theme .block-button {
            background: linear-gradient(145deg, #ef4444, #dc2626);
        }
        
        .light-theme .slow-button {
            background: linear-gradient(145deg, #f59e0b, #d97706);
        }
        
        .light-theme .limit-button {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
        }
        
        .light-theme .exit-button {
            background: linear-gradient(145deg, #10b981, #059669);
            box-shadow: 0 12px 25px rgba(16, 185, 129, 0.3);
        }
        
        /* Вернул кнопку переключения тем как было */
        .toggle-theme-label {
            height: 40px;
            width: 80px;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: inset 0 0 5px 4px rgba(255, 255, 255, 1),
                inset 0 0 20px 1px rgba(0, 0, 0, 0.488), 10px 20px 30px rgba(0, 0, 0, 0.096),
                inset 0 0 0 3px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: transform var(--transition-normal);
            will-change: transform;
        }

        .toggle-theme-label:hover {
            transform: perspective(100px) rotateX(5deg) rotateY(-5deg);
        }

        #toggle-theme:checked ~ .toggle-theme-label:hover {
            transform: perspective(100px) rotateX(-5deg) rotateY(5deg);
        }

        #toggle-theme {
            display: none;
        }

        #toggle-theme:checked ~ .toggle-theme-label::before {
            left: 45px;
            background-color: #000000;
            background-image: linear-gradient(315deg, #000000 0%, #414141 70%);
            transition: var(--transition-normal);
        }

        .toggle-theme-label::before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            border-radius: 50%;
            background-color: #000000;
            background-image: linear-gradient(
                130deg,
                #757272 10%,
                #ffffff 11%,
                #726f6f 62%
            );
            left: 5px;
            box-shadow: 0 2px 1px rgba(0, 0, 0, 0.3), 10px 10px 10px rgba(0, 0, 0, 0.3);
            transition: var(--transition-normal);
            will-change: left, background-color;
        }
        
        .light-theme .toggle-theme-label {
            background-color: #ffffff;
            box-shadow: inset 0 0 5px 4px rgba(255, 255, 255, 1),
                inset 0 0 20px 1px rgba(0, 0, 0, 0.488), 10px 20px 30px rgba(0, 0, 0, 0.096),
                inset 0 0 0 3px rgba(0, 0, 0, 0.3);
        }
        
        .light-theme .toggle-theme-label::before {
            background-color: #000000;
            background-image: linear-gradient(
                130deg,
                #757272 10%,
                #ffffff 11%,
                #726f6f 62%
            );
        }
        
        .light-theme #toggle-theme:checked ~ .toggle-theme-label::before {
            background-color: #000000;
            background-image: linear-gradient(315deg, #000000 0%, #414141 70%);
        }
        
        /* Оптимизированные анимации */
        @keyframes optimized-pulse {
            0%, 100% { 
                opacity: 0.5;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.05);
            }
        }
        
        @keyframes optimized-glow {
            0%, 100% { 
                box-shadow: 0 0 20px currentColor;
            }
            50% { 
                box-shadow: 0 0 40px currentColor;
            }
        }
        
        /* Отключение поддержки телефонов */
        @media (max-width: 768px) {
            body::before {
                content: "Приложение доступно только на компьютерах";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #000;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                text-align: center;
                padding: 20px;
                z-index: 99999;
            }
            
            #loader,
            .content,
            .toggle-theme-container {
                display: none !important;
            }
        }
        
        /* Кнопка переключения темы */
        .toggle-theme-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: var(--z-index-theme);
        }
        
        /* Оптимизированный загрузчик */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-index-loader);
            transition: opacity 0.5s ease;
            will-change: opacity;
        }
        
        .loader-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 220px;
            height: 220px;
            font-family: "Inter", sans-serif;
            font-size: 1.8em;
            font-weight: 650;
            color: white;
            border-radius: 50%;
            background-color: transparent;
            user-select: none;
            transform: translateZ(0);
        }

        .loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 50%;
            background-color: transparent;
            animation: loader-rotate 2s linear infinite;
            z-index: 0;
            will-change: transform, box-shadow;
            transform: translateZ(0);
        }

        .loader::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.3) 0%, transparent 70%);
            animation: optimized-pulse 2s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes loader-rotate {
            0% {
                transform: rotate(90deg);
                box-shadow:
                    0 10px 20px 0 #fff inset,
                    0 20px 30px 0 #6366f1 inset,
                    0 60px 60px 0 #0f172a inset;
            }
            50% {
                transform: rotate(270deg);
                box-shadow:
                    0 10px 20px 0 #fff inset,
                    0 20px 10px 0 #4f46e5 inset,
                    0 40px 60px 0 #000000 inset;
            }
            100% {
                transform: rotate(450deg);
                box-shadow:
                    0 10px 20px 0 #fff inset,
                    0 20px 30px 0 #6366f1 inset,
                    0 60px 60px 0 #0f172a inset;
            }
        }

        .loader-letter {
            display: inline-block;
            opacity: 0.4;
            transform: translateY(0);
            animation: loader-letter-anim 2s infinite;
            z-index: 1;
            font-weight: 650;
            transform: translateZ(0);
            will-change: opacity, transform;
        }

        .loader-letter:nth-child(1) { animation-delay: 0s; }
        .loader-letter:nth-child(2) { animation-delay: 0.1s; }
        .loader-letter:nth-child(3) { animation-delay: 0.2s; }
        .loader-letter:nth-child(4) { animation-delay: 0.3s; }
        .loader-letter:nth-child(5) { animation-delay: 0.4s; }
        .loader-letter:nth-child(6) { animation-delay: 0.5s; }
        .loader-letter:nth-child(7) { animation-delay: 0.6s; }

        @keyframes loader-letter-anim {
            0%, 100% {
                opacity: 0.4;
                transform: translateY(0) scale(1);
            }
            20% {
                opacity: 1;
                transform: scale(1.15);
            }
            40% {
                opacity: 0.7;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Основной контент */
        .content {
            position: relative;
            z-index: 1;
            display: none;
            min-height: 100vh;
            padding: 20px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
            will-change: transform;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            text-align: center;
            padding: 20px;
            transform-style: preserve-3d;
        }
        
        .header {
            margin-bottom: 30px;
            transform-style: preserve-3d;
        }
        
        /* Оптимизированный контейнер рулетки */
        .roulette-container {
            position: relative;
            width: 100%;
            margin: 40px 0;
            overflow: hidden;
            border-radius: 20px;
            background: rgba(10, 14, 42, 0.8);
            padding: 25px 25px 40px 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transform-style: preserve-3d;
            transform: translateZ(0);
            will-change: transform;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .arrow {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateZ(50px);
            z-index: 20;
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-top: 50px solid #8b5cf6;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.8));
            transition: all var(--transition-normal);
            animation: arrowPulse 2s infinite;
            will-change: transform, filter;
        }
        
        @keyframes arrowPulse {
            0%, 100% { 
                transform: translateX(-50%) translateZ(50px) scale(1); 
            }
            50% { 
                transform: translateX(-50%) translateZ(50px) scale(1.05); 
            }
        }
        
        .arrow::after {
            content: "";
            position: absolute;
            top: -60px;
            left: -15px;
            width: 30px;
            height: 30px;
            background: #8b5cf6;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.8);
            will-change: box-shadow;
        }
        
        .wheel-container {
            width: 100%;
            overflow: hidden;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.3);
            padding: 25px 0;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: 40px;
            transform-style: preserve-3d;
            transform: translateZ(10px);
            will-change: transform;
        }
        
        .wheel {
            display: flex;
            transition-timing-function: cubic-bezier(0.1, 0.2, 0.3, 1);
            width: max-content;
            transform-style: preserve-3d;
            will-change: transform;
        }
        
        .wheel-item {
            width: 180px;
            height: 180px;
            margin: 0 15px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(145deg, #1a1f3d, #15182f);
            color: #fff;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
            transition: all var(--transition-normal);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transform-style: preserve-3d;
            transform: translateZ(0);
            will-change: transform, box-shadow;
        }
        
        .wheel-item::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0));
            z-index: 1;
        }
        
        .wheel-item.active {
            transform: scale(1.15) translateZ(30px);
            box-shadow: 0 0 30px #8b5cf6, 0 10px 25px rgba(0, 0, 0, 0.6);
            z-index: 5;
            border-color: rgba(139, 92, 246, 0.3);
            animation: optimized-glow 1.5s infinite alternate;
            will-change: transform, box-shadow;
        }
        
        .wheel-item-logo {
            font-size: 70px;
            margin-bottom: 15px;
            z-index: 2;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5));
            transform: translateZ(20px);
            will-change: transform;
        }
        
        .wheel-item-name {
            font-size: 1.2rem;
            font-weight: 600;
            z-index: 2;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.7);
            transform: translateZ(15px);
            will-change: transform;
        }
        
        /* Цвета для иконок */
        .apple .wheel-item-logo { color: #ffffff; background: #000000; padding: 10px; border-radius: 20px; }
        .yandex .wheel-item-logo { color: #ff0000; }
        .figma .wheel-item-logo { color: #f24e1e; }
        .minecraft .wheel-item-logo { color: #6aaa3f; }
        .google .wheel-item-logo { color: #4285f4; }
        .facebook .wheel-item-logo { color: #1877f2; }
        .telegram .wheel-item-logo { color: #26a5e4; }
        .vk .wheel-item-logo { color: #4c75a3; }
        .whatsapp .wheel-item-logo { color: #25d366; }
        .twitter .wheel-item-logo { color: #1da1f2; }
        .instagram .wheel-item-logo { color: #e4405f; }
        .spotify .wheel-item-logo { color: #1db954; }
        .netflix .wheel-item-logo { color: #e50914; }
        .discord .wheel-item-logo { color: #5865f2; }
        .tiktok .wheel-item-logo { color: #000000; background: #ffffff; padding: 5px; border-radius: 10px; }
        .youtube .wheel-item-logo { color: #ff0000; }
        .twitch .wheel-item-logo { color: #9146ff; }
        .reddit .wheel-item-logo { color: #ff4500; }
        .linkedin .wheel-item-logo { color: #0a66c2; }
        .pinterest .wheel-item-logo { color: #e60023; }
        .zoom .wheel-item-logo { color: #2d8cff; }
        .skype .wheel-item-logo { color: #00aff0; }
        .github .wheel-item-logo { color: #ffffff; background: #000000; padding: 10px; border-radius: 20px; }
        .steam .wheel-item-logo { color: #000000; background: #1b2838; padding: 10px; border-radius: 20px; }
        .amazon .wheel-item-logo { color: #ff9900; }
        .microsoft .wheel-item-logo { color: #00a4ef; }
        .dropbox .wheel-item-logo { color: #0061ff; }
        .snapchat .wheel-item-logo { color: #fffc00; background: #000; padding: 5px; border-radius: 10px; }
        .paypal .wheel-item-logo { color: #003087; }
        .uber .wheel-item-logo { color: #000000; }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            transform-style: preserve-3d;
        }
        
        .control-button {
            background: linear-gradient(145deg, #283593, #3949ab);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            transition: all var(--transition-normal);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform-style: preserve-3d;
            transform: translateZ(0);
            position: relative;
            overflow: hidden;
            will-change: transform, background;
        }
        
        .control-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), transparent);
            border-radius: 50px;
            opacity: 0;
            transition: opacity var(--transition-normal);
            z-index: 1;
        }
        
        .control-button:hover::before {
            opacity: 1;
        }
        
        /* УВЕЛИЧЕННАЯ кнопка "Крутить колесо" */
        .spin-button {
            border-radius: 20px;
            padding: 30px 70px;
            min-width: 300px;
            font-size: 24px;
            line-height: 30px;
            font: inherit;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            letter-spacing: inherit;
            font-weight: 600;
            color: rgba(255 255 255 / 95%);
            border: none;
            position: relative;
            cursor: pointer;
            appearance: none;
            background: radial-gradient(
                var(--spread-x) var(--spread-y) at var(--pos-x) var(--pos-y),
                var(--color-1) var(--stop-1),
                var(--color-2) var(--stop-2),
                var(--color-3) var(--stop-3),
                var(--color-4) var(--stop-4),
                var(--color-5) var(--stop-5)
            );
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.95);
            outline: none;
            -webkit-tap-highlight-color: transparent;
            transition:
                --pos-x 0.5s,
                --pos-y 0.5s,
                --spread-x 0.5s,
                --spread-y 0.5s,
                --color-1 0.5s,
                --color-2 0.5s,
                --color-3 0.5s,
                --color-4 0.5s,
                --color-5 0.5s,
                --border-angle 0.5s,
                --border-color-1 0.5s,
                --border-color-2 0.5s,
                --stop-1 0.5s,
                --stop-2 0.5s,
                --stop-3 0.5s,
                --stop-4 0.5s,
                --stop-5 0.5s;
            margin: 50px auto;
            display: block;
            transform-style: preserve-3d;
            transform: translateZ(0);
            z-index: 10;
            position: relative;
            will-change: transform, background;
        }

        .spin-button::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 3px;
            background-image: linear-gradient(var(--border-angle), var(--border-color-1), var(--border-color-2));
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            pointer-events: none;
        }

        .spin-button:hover {
            --pos-x: 0%;
            --pos-y: 120%;
            --spread-x: 110.24%;
            --spread-y: 110.2%;

            --color-1: #000020;
            --color-2: #f1ffa5;
            --color-3: #469396;
            --color-4: #1f3f6d;

            --stop-1: 0%;
            --stop-2: 10%;
            --stop-3: 35.44%;
            --stop-4: 71.34%;
            --stop-5: 150%;

            --border-angle: 190deg;
            --border-color-1: hsla(320, 75%, 90%, 0.1);
            --border-color-2: hsla(320, 50%, 90%, 0.35);
        }

        .spin-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .spin-button i {
            margin-right: 20px;
            font-size: 2.5rem;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transform-style: preserve-3d;
            transform: translateZ(10px);
            position: relative;
            z-index: 10;
            will-change: transform;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .stat-item {
            text-align: center;
            transform-style: preserve-3d;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #8b5cf6;
            text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
            transform: translateZ(15px);
            will-change: transform;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #a0a8ff;
            margin-top: 5px;
            transform: translateZ(10px);
            will-change: transform;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: var(--z-index-modal);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            perspective: 1000px;
            will-change: opacity;
        }
        
        .modal-content {
            background: linear-gradient(145deg, #15182f, #111633);
            width: 90%;
            max-width: 600px;
            border-radius: 25px;
            padding: 50px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            animation: modalAppear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            transform: translateZ(0);
            z-index: calc(var(--z-index-modal) + 1);
            will-change: transform, opacity;
        }
        
        .modal-content::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #8b5cf6, #ec4899, #8b5cf6);
            will-change: background;
        }
        
        @keyframes modalAppear {
            from { 
                opacity: 0; 
                transform: translateY(-80px) scale(0.9) rotateX(10deg); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1) rotateX(0); 
            }
        }
        
        .selected-logo-container {
            position: relative;
            height: 200px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-style: preserve-3d;
        }
        
        .selected-logo {
            font-size: 100px;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.7));
            animation: logoPulse 2s infinite;
            transform: translateZ(40px);
            will-change: transform, filter;
        }
        
        @keyframes logoPulse {
            0% { transform: translateZ(40px) scale(1); }
            50% { transform: translateZ(40px) scale(1.1); }
            100% { transform: translateZ(40px) scale(1); }
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 20px;
            transform-style: preserve-3d;
        }
        
        .action-button {
            flex: 1;
            padding: 20px 15px;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-normal);
            color: white;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 120px;
            transform-style: preserve-3d;
            transform: translateZ(0);
            will-change: transform, background;
        }
        
        .action-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity var(--transition-normal);
            z-index: 1;
        }
        
        .action-button::after {
            content: "";
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 17px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s;
            will-change: opacity;
        }
        
        .block-button {
            background: linear-gradient(145deg, #d32f2f, #b71c1c);
        }
        
        .block-button::after {
            background: linear-gradient(45deg, #ff5252, #ff8a80, #ff5252);
        }
        
        .slow-button {
            background: linear-gradient(145deg, #ff9800, #f57c00);
        }
        
        .slow-button::after {
            background: linear-gradient(45deg, #ff9800, #ffcc80, #ff9800);
        }
        
        .limit-button {
            background: linear-gradient(145deg, #2196f3, #1976d2);
        }
        
        .limit-button::after {
            background: linear-gradient(45deg, #2196f3, #82b1ff, #2196f3);
        }
        
        .action-button:hover::before {
            opacity: 1;
        }
        
        .action-button:hover::after {
            opacity: 0.5;
        }
        
        .action-button i {
            font-size: 2rem;
            margin-bottom: 10px;
            transform: translateZ(20px);
            will-change: transform;
        }
        
        .button-text {
            font-size: 1.1rem;
            transform: translateZ(15px);
            will-change: transform;
        }
        
        .result-modal .modal-content {
            max-width: 500px;
        }
        
        .success-icon {
            font-size: 120px;
            color: #4caf50;
            margin-bottom: 30px;
            filter: drop-shadow(0 10px 20px rgba(76, 175, 80, 0.4));
            animation: optimized-pulse 2s infinite;
            transform: translateZ(50px);
            will-change: transform;
        }
        
        .result-text {
            font-size: 2.2rem;
            margin-bottom: 40px;
            line-height: 1.4;
            background: linear-gradient(to right, #4caf50, #8bc34a);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-weight: 700;
            transform: translateZ(30px);
            will-change: transform;
        }
        
        .exit-button {
            background: linear-gradient(145deg, #4caf50, #388e3c);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.5rem;
            border-radius: 60px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 12px 25px rgba(76, 175, 80, 0.4);
            transition: all var(--transition-normal);
            font-weight: bold;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transform-style: preserve-3d;
            transform: translateZ(0);
            will-change: transform, background;
        }
        
        .exit-button::after {
            content: "";
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #4caf50, #a5d6a7, #4caf50);
            border-radius: 63px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s;
            will-change: opacity;
        }
        
        .exit-button:hover::after {
            opacity: 0.4;
        }
        
        .exit-button i {
            margin-right: 15px;
        }
        
        /* Оптимизация производительности для анимаций */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Кнопка переключения темы -->
    <div class="toggle-theme-container">
        <input type="checkbox" name="toggle-theme" id="toggle-theme" />
        <label for="toggle-theme" class="toggle-theme-label"></label>
    </div>
    
    <!-- Загрузчик -->
    <div id="loader">
        <div class="loader-wrapper">
            <div class="loader"></div>
            <div class="loader-text">
                <span class="loader-letter">L</span>
                <span class="loader-letter">O</span>
                <span class="loader-letter">A</span>
                <span class="loader-letter">D</span>
                <span class="loader-letter">I</span>
                <span class="loader-letter">N</span>
                <span class="loader-letter">G</span>
            </div>
        </div>
    </div>
    
    <!-- Основной контент -->
    <div class="content" id="content">
        <div class="container">
            <div class="header">
                <div class="roskom-logo">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h1>РОСКОМНАДЗОР</h1>
                <div class="subtitle">Что заблокировать сегодня?</div>
            </div>
            
            <div class="roulette-container">
                <div class="arrow"></div>
                <div class="wheel-container">
                    <div class="wheel" id="wheel">
                        <!-- Wheel items will be generated by JavaScript -->
                    </div>
                </div>
                
                <div class="controls">
                    <button class="control-button" id="speedUp">
                        <i class="fas fa-forward"></i> Ускорить
                    </button>
                    <button class="control-button" id="speedDown">
                        <i class="fas fa-backward"></i> Замедлить
                    </button>
                    <button class="control-button" id="addService">
                        <i class="fas fa-plus"></i> Добавить сервис
                    </button>
                    <button class="control-button" id="viewHistory">
                        <i class="fas fa-history"></i> История
                    </button>
                </div>
            </div>
            
            <button class="spin-button" id="spinButton">
                <i class="fas fa-play-circle"></i> КРУТИТЬ КОЛЕСО
            </button>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalSpins">0</div>
                    <div class="stat-label">Всего вращений</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalBlocks">0</div>
                    <div class="stat-label">Заблокировано</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentSpeed">1x</div>
                    <div class="stat-label">Скорость</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="servicesCount">0</div>
                    <div class="stat-label">Сервисов в колесе</div>
                </div>
            </div>
        </div>
        
        <!-- Modal for selected service -->
        <div class="modal" id="serviceModal">
            <div class="modal-content">
                <div class="selected-logo-container">
                    <div class="selected-logo" id="selectedLogo">
                        <i class="fab fa-apple"></i>
                    </div>
                </div>
                <div style="font-size: 2.8rem; margin-bottom: 30px; color: #8b5cf6; text-shadow: 0 5px 15px rgba(139, 92, 246, 0.3); font-weight: 700;" id="selectedName">Apple</div>
                <p style="font-size: 1.2rem; color: #a0a8ff; margin-bottom: 20px;">Выберите действие для данного сервиса:</p>
                <div class="action-buttons">
                    <button class="action-button block-button" data-action="block">
                        <i class="fas fa-ban"></i>
                        <span class="button-text">Заблокировать</span>
                    </button>
                    <button class="action-button slow-button" data-action="slow">
                        <i class="fas fa-tachometer-alt"></i>
                        <span class="button-text">Замедлить</span>
                    </button>
                    <button class="action-button limit-button" data-action="limit">
                        <i class="fas fa-exclamation-circle"></i>
                        <span class="button-text">Ограничить</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Modal for result -->
        <div class="modal result-modal" id="resultModal">
            <div class="modal-content">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="result-text" id="resultText">
                    Apple успешно заблокирован
                </div>
                <button class="exit-button" id="exitButton">
                    <i class="fas fa-check"></i> Закрыть
                </button>
            </div>
        </div>
        
        <!-- History modal -->
        <div class="modal" id="historyModal">
            <div class="modal-content">
                <h2 style="margin-bottom: 20px; color: #8b5cf6;">История блокировок</h2>
                <div style="max-height: 400px; overflow-y: auto; margin-top: 20px; text-align: left; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 10px;" id="historyList">
                    <!-- History items will be added here -->
                </div>
                <button class="exit-button" id="closeHistory" style="margin-top: 30px; background: linear-gradient(145deg, #757575, #616161);">
                    <i class="fas fa-times"></i> Закрыть
                </button>
            </div>
        </div>
    </div>

    <script>
        // Оптимизация: создаем один RAF loop для анимаций
        let lastTime = 0;
        const fps = 60;
        const interval = 1000 / fps;
        
        // Service data with more services
        const baseServices = [
            { name: "Apple", icon: "fab fa-apple", class: "apple" },
            { name: "Yandex", icon: "fab fa-yandex", class: "yandex" },
            { name: "Figma", icon: "fab fa-figma", class: "figma" },
            { name: "Minecraft", icon: "fas fa-cube", class: "minecraft" },
            { name: "Google", icon: "fab fa-google", class: "google" },
            { name: "Facebook", icon: "fab fa-facebook", class: "facebook" },
            { name: "Telegram", icon: "fab fa-telegram", class: "telegram" },
            { name: "VK", icon: "fab fa-vk", class: "vk" },
            { name: "WhatsApp", icon: "fab fa-whatsapp", class: "whatsapp" },
            { name: "Twitter", icon: "fab fa-twitter", class: "twitter" },
            { name: "Instagram", icon: "fab fa-instagram", class: "instagram" },
            { name: "Spotify", icon: "fab fa-spotify", class: "spotify" },
            { name: "Netflix", icon: "fab fa-netflix", class: "netflix" },
            { name: "Discord", icon: "fab fa-discord", class: "discord" },
            { name: "TikTok", icon: "fab fa-tiktok", class: "tiktok" },
            { name: "YouTube", icon: "fab fa-youtube", class: "youtube" },
            { name: "Twitch", icon: "fab fa-twitch", class: "twitch" },
            { name: "Reddit", icon: "fab fa-reddit", class: "reddit" },
            { name: "LinkedIn", icon: "fab fa-linkedin", class: "linkedin" },
            { name: "Pinterest", icon: "fab fa-pinterest", class: "pinterest" },
            { name: "Zoom", icon: "fas fa-video", class: "zoom" },
            { name: "Skype", icon: "fab fa-skype", class: "skype" },
            { name: "GitHub", icon: "fab fa-github", class: "github" },
            { name: "Steam", icon: "fab fa-steam", class: "steam" },
            { name: "Amazon", icon: "fab fa-amazon", class: "amazon" },
            { name: "Microsoft", icon: "fab fa-microsoft", class: "microsoft" },
            { name: "Dropbox", icon: "fab fa-dropbox", class: "dropbox" },
            { name: "Snapchat", icon: "fab fa-snapchat", class: "snapchat" },
            { name: "PayPal", icon: "fab fa-paypal", class: "paypal" },
            { name: "Uber", icon: "fab fa-uber", class: "uber" }
        ];
        
        // DOM elements caching
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spinButton');
        const serviceModal = document.getElementById('serviceModal');
        const resultModal = document.getElementById('resultModal');
        const historyModal = document.getElementById('historyModal');
        const selectedLogo = document.getElementById('selectedLogo');
        const selectedName = document.getElementById('selectedName');
        const resultText = document.getElementById('resultText');
        const actionButtons = document.querySelectorAll('.action-button');
        const exitButton = document.getElementById('exitButton');
        const closeHistory = document.getElementById('closeHistory');
        const historyList = document.getElementById('historyList');
        const speedUp = document.getElementById('speedUp');
        const speedDown = document.getElementById('speedDown');
        const addService = document.getElementById('addService');
        const viewHistory = document.getElementById('viewHistory');
        const totalSpins = document.getElementById('totalSpins');
        const totalBlocks = document.getElementById('totalBlocks');
        const currentSpeed = document.getElementById('currentSpeed');
        const servicesCount = document.getElementById('servicesCount');
        const loader = document.getElementById('loader');
        const content = document.getElementById('content');
        const toggleTheme = document.getElementById('toggle-theme');
        
        // Game state
        let isSpinning = false;
        let currentService = null;
        let currentAction = null;
        let selectedWheelItem = null;
        let wheelItems = [];
        let targetItemIndex = -1;
        let history = [];
        let userServices = [...baseServices];
        let spinSpeed = 1;
        let spinCount = 0;
        let blockCount = 0;
        
        // Переменная для отслеживания текущей позиции колеса
        let currentWheelPosition = 0;
        
        // Debounce для resize
        let resizeTimeout;
        
        // Optimized function to throttle events
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }
        
        // Переключение темы
        toggleTheme.addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('light-theme');
                localStorage.setItem('theme', 'light');
            } else {
                document.body.classList.remove('light-theme');
                localStorage.setItem('theme', 'dark');
            }
        });
        
        // Восстановление темы из localStorage
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            toggleTheme.checked = true;
        }
        
        // Показать загрузчик на 3.5 секунды
        setTimeout(() => {
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
                content.style.display = 'flex';
                // Инициализация после загрузки
                requestAnimationFrame(initializeAfterLoad);
            }, 500);
        }, 3500);
        
        function initializeAfterLoad() {
            initializeWheel();
            updateHistory();
            totalSpins.textContent = spinCount;
            totalBlocks.textContent = blockCount;
            currentSpeed.textContent = spinSpeed.toFixed(1) + 'x';
            create3DButtonEffect();
        }
        
        // Оптимизированная инициализация колеса
        function initializeWheel() {
            wheel.innerHTML = '';
            wheelItems = [];
            
            const repeatCount = 30; // Уменьшил количество повторений для оптимизации
            
            // Используем DocumentFragment для оптимизации
            const fragment = document.createDocumentFragment();
            
            for (let i = 0; i < repeatCount; i++) {
                userServices.forEach((service, index) => {
                    const wheelItem = document.createElement('div');
                    wheelItem.className = `wheel-item ${service.class}`;
                    wheelItem.dataset.service = service.name;
                    wheelItem.dataset.icon = service.icon;
                    wheelItem.dataset.index = wheelItems.length;
                    wheelItem.dataset.originalIndex = index;
                    
                    const logo = document.createElement('div');
                    logo.className = 'wheel-item-logo';
                    logo.innerHTML = `<i class="${service.icon}"></i>`;
                    
                    const name = document.createElement('div');
                    name.className = 'wheel-item-name';
                    name.textContent = service.name;
                    
                    wheelItem.appendChild(logo);
                    wheelItem.appendChild(name);
                    fragment.appendChild(wheelItem);
                    wheelItems.push(wheelItem);
                });
            }
            
            wheel.appendChild(fragment);
            servicesCount.textContent = userServices.length;
            centerWheel();
            
            // Делегирование событий для оптимизации
            wheel.addEventListener('mouseover', handleWheelItemMouseOver);
            wheel.addEventListener('mouseout', handleWheelItemMouseOut);
            wheel.addEventListener('click', handleWheelItemClick);
        }
        
        function handleWheelItemMouseOver(e) {
            const item = e.target.closest('.wheel-item');
            if (item && !isSpinning) {
                item.style.transform = 'translateZ(30px) scale(1.05)';
            }
        }
        
        function handleWheelItemMouseOut(e) {
            const item = e.target.closest('.wheel-item');
            if (item && !isSpinning && !item.classList.contains('active')) {
                item.style.transform = 'translateZ(0) scale(1)';
            }
        }
        
        function handleWheelItemClick(e) {
            const item = e.target.closest('.wheel-item');
            if (item && !isSpinning) {
                selectWheelItem(item);
            }
        }
        
        function clearActiveItems() {
            wheelItems.forEach(item => {
                item.classList.remove('active');
                item.style.transform = 'translateZ(0) scale(1)';
            });
        }
        
        function centerWheel() {
            const containerWidth = document.querySelector('.wheel-container').offsetWidth;
            const wheelWidth = wheel.scrollWidth;
            const initialOffset = (wheelWidth - containerWidth) / 2;
            wheel.style.transform = `translateX(${-initialOffset}px)`;
            currentWheelPosition = -initialOffset;
        }
        
        // Новая функция для телепортации колеса
        function teleportWheelIfNeeded() {
            const containerWidth = document.querySelector('.wheel-container').offsetWidth;
            const wheelWidth = wheel.scrollWidth;
            const itemWidth = 210;
            
            // Проверяем, если колесо вышло за пределы контента
            if (Math.abs(currentWheelPosition) > wheelWidth - containerWidth + itemWidth) {
                // Телепортируем на один элемент вперед (с начала)
                const teleportOffset = itemWidth * userServices.length;
                currentWheelPosition += teleportOffset;
                wheel.style.transition = 'none';
                wheel.style.transform = `translateX(${currentWheelPosition}px)`;
                
                // Принудительный reflow
                wheel.offsetHeight;
                
                // Возвращаем плавную анимацию
                wheel.style.transition = '';
                
                console.log('Teleported wheel forward by', teleportOffset, 'px');
                return true;
            }
            
            return false;
        }
        
        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            spinButton.disabled = true;
            
            clearActiveItems();
            
            const randomPixels = Math.floor(Math.random() * 20000) + 5000;
            currentWheelPosition -= randomPixels;
            const speedMultiplier = 1 / spinSpeed;
            const spinDuration = 3 * speedMultiplier;
            
            // Проверяем и телепортируем перед началом вращения
            teleportWheelIfNeeded();
            
            wheel.style.transition = `transform ${spinDuration}s cubic-bezier(0.1, 0.5, 0.2, 1)`;
            wheel.style.transform = `translateX(${currentWheelPosition}px)`;
            
            // Запускаем проверку телепортации во время вращения
            const teleportCheckInterval = setInterval(() => {
                teleportWheelIfNeeded();
            }, 100);
            
            setTimeout(() => {
                clearInterval(teleportCheckInterval);
                
                const closestItem = findClosestItemToArrow();
                if (closestItem !== -1) {
                    fineTuneToItem(closestItem);
                } else {
                    isSpinning = false;
                    spinButton.disabled = false;
                }
            }, spinDuration * 1000);
            
            spinCount++;
            totalSpins.textContent = spinCount;
        }
        
        function findClosestItemToArrow() {
            const containerWidth = document.querySelector('.wheel-container').offsetWidth;
            const itemWidth = 210;
            const visibleItemsCount = Math.floor(containerWidth / itemWidth);
            const arrowPositionIndex = Math.floor(visibleItemsCount / 2);
            
            const arrowPositionX = Math.abs(currentWheelPosition) + (arrowPositionIndex * itemWidth) + (itemWidth / 2);
            
            let closestItemIndex = -1;
            let minDistance = Infinity;
            
            // Оптимизированный поиск ближайшего элемента
            const startIndex = Math.floor(arrowPositionX / itemWidth) - 5;
            const endIndex = Math.min(wheelItems.length, Math.ceil(arrowPositionX / itemWidth) + 5);
            
            for (let i = Math.max(0, startIndex); i < endIndex; i++) {
                const itemCenterX = (i * itemWidth) + (itemWidth / 2);
                const distance = Math.abs(itemCenterX - arrowPositionX);
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestItemIndex = i;
                }
            }
            
            return closestItemIndex;
        }
        
        function fineTuneToItem(itemIndex) {
            if (itemIndex < 0 || itemIndex >= wheelItems.length) {
                isSpinning = false;
                spinButton.disabled = false;
                return;
            }
            
            const containerWidth = document.querySelector('.wheel-container').offsetWidth;
            const itemWidth = 210;
            const visibleItemsCount = Math.floor(containerWidth / itemWidth);
            const arrowPositionIndex = Math.floor(visibleItemsCount / 2);
            
            const targetX = (itemIndex * itemWidth) + (itemWidth / 2) - (arrowPositionIndex * itemWidth) - (itemWidth / 2);
            currentWheelPosition = -targetX;
            
            wheel.style.transition = 'transform 1s cubic-bezier(0.2, 0.9, 0.3, 1)';
            wheel.style.transform = `translateX(${-targetX}px)`;
            
            targetItemIndex = itemIndex;
            
            setTimeout(() => {
                if (wheelItems[itemIndex]) {
                    wheelItems[itemIndex].classList.add('active');
                    wheelItems[itemIndex].style.transform = 'translateZ(50px) scale(1.15)';
                    selectedWheelItem = wheelItems[itemIndex];
                    
                    const selectedServiceIndex = itemIndex % userServices.length;
                    const selectedServiceData = userServices[selectedServiceIndex];
                    
                    if (selectedServiceData) {
                        currentService = selectedServiceData;
                        
                        const arrow = document.querySelector('.arrow');
                        arrow.style.animation = 'none';
                        setTimeout(() => {
                            arrow.style.transform = 'translateX(-50%) translateZ(70px) scale(1.4)';
                            setTimeout(() => {
                                arrow.style.transform = 'translateX(-50%) translateZ(50px) scale(1)';
                                arrow.style.animation = 'arrowPulse 2s infinite';
                            }, 300);
                        }, 10);
                        
                        setTimeout(() => {
                            showServiceModal(currentService);
                        }, 1000);
                    }
                }
                
                isSpinning = false;
                spinButton.disabled = false;
            }, 1000);
        }
        
        function selectWheelItem(item) {
            clearActiveItems();
            item.classList.add('active');
            item.style.transform = 'translateZ(50px) scale(1.15)';
            
            const serviceName = item.dataset.service;
            const serviceIcon = item.dataset.icon;
            
            currentService = userServices.find(s => s.name === serviceName);
            if (!currentService) {
                currentService = {
                    name: serviceName,
                    icon: serviceIcon,
                    class: serviceName.toLowerCase()
                };
            }
            
            showServiceModal(currentService);
        }
        
        function showServiceModal(service) {
            selectedLogo.innerHTML = `<i class="${service.icon}"></i>`;
            selectedName.textContent = service.name;
            serviceModal.style.display = 'flex';
        }
        
        function showResultModal(service, action) {
            let actionPast = "";
            
            switch(action) {
                case "block":
                    actionPast = "заблокирован";
                    blockCount++;
                    totalBlocks.textContent = blockCount;
                    break;
                case "slow":
                    actionPast = "замедлен";
                    break;
                case "limit":
                    actionPast = "ограничен";
                    break;
            }
            
            const historyItem = {
                service: service.name,
                action: actionPast,
                icon: service.icon,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            history.unshift(historyItem);
            updateHistory();
            
            resultText.textContent = `${service.name} успешно ${actionPast}`;
            resultModal.style.display = 'flex';
        }
        
        function updateHistory() {
            historyList.innerHTML = '';
            const recentHistory = history.slice(0, 10);
            
            // Используем DocumentFragment для оптимизации
            const fragment = document.createDocumentFragment();
            
            recentHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px;
                    margin-bottom: 10px;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 10px;
                    border-left: 4px solid #8b5cf6;
                `;
                historyItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="${item.icon}" style="font-size: 24px;"></i>
                        <div>
                            <div style="font-weight: bold;">${item.service}</div>
                            <div style="color: #a0a8ff; font-size: 0.9rem;">${item.time}</div>
                        </div>
                    </div>
                    <div style="color: #8b5cf6; font-weight: bold;">${item.action}</div>
                `;
                fragment.appendChild(historyItem);
            });
            
            historyList.appendChild(fragment);
        }
        
        function changeSpeed(delta) {
            spinSpeed = Math.max(0.5, Math.min(3, spinSpeed + delta));
            currentSpeed.textContent = spinSpeed.toFixed(1) + 'x';
        }
        
        // Event listeners
        spinButton.addEventListener('click', spinWheel);
        
        actionButtons.forEach(button => {
            button.addEventListener('click', function() {
                currentAction = this.dataset.action;
                serviceModal.style.display = 'none';
                showResultModal(currentService, currentAction);
            });
        });
        
        exitButton.addEventListener('click', function() {
            resultModal.style.display = 'none';
        });
        
        closeHistory.addEventListener('click', function() {
            historyModal.style.display = 'none';
        });
        
        speedUp.addEventListener('click', function() {
            changeSpeed(0.1);
        });
        
        speedDown.addEventListener('click', function() {
            changeSpeed(-0.1);
        });
        
        addService.addEventListener('click', function() {
            alert('Функция добавления сервиса временно недоступна');
        });
        
        viewHistory.addEventListener('click', function() {
            updateHistory();
            historyModal.style.display = 'flex';
        });
        
        // Оптимизированное закрытие модалок
        [serviceModal, resultModal, historyModal].forEach(modal => {
            modal.addEventListener('click', function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            });
        });
        
        // Оптимизированный resize с throttle
        window.addEventListener('resize', throttle(function() {
            if (!isSpinning) {
                centerWheel();
            }
        }, 250));
        
        // 3D эффект для кнопок
        function create3DButtonEffect() {
            const buttons = document.querySelectorAll('.spin-button, .action-button, .control-button, .exit-button');
            
            buttons.forEach(button => {
                button.addEventListener('mousemove', throttle((e) => {
                    if (button.disabled) return;
                    
                    const rect = button.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const deltaX = (x - centerX) / centerX;
                    const deltaY = (y - centerY) / centerY;
                    const maxTilt = 8;
                    const rotateY = deltaX * maxTilt;
                    const rotateX = -deltaY * maxTilt;
                    const lift = 15 + Math.abs(deltaX) * 5 + Math.abs(deltaY) * 5;
                    
                    button.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(${lift}px)`;
                }, 16)); // ~60fps
                
                button.addEventListener('mouseleave', () => {
                    if (button.disabled) return;
                    button.style.transition = 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    button.style.transform = 'translateZ(0)';
                    setTimeout(() => { button.style.transition = ''; }, 300);
                });
            });
        }
        
        // Запуск оптимизированной инициализации
        requestAnimationFrame(initializeAfterLoad);
    </script>
</body>
</html>